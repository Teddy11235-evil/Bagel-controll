<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>//_RENDER_FARM_CTRL</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        
        :root {
            --matrix-green: #0f0;
            --dark-bg: #0a0a0a;
            --terminal-bg: #001100;
            --glow: 0 0 10px var(--matrix-green);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Share Tech Mono', monospace;
        }
        
        body {
            background: var(--dark-bg);
            color: var(--matrix-green);
            overflow-x: hidden;
            position: relative;
        }
        
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(0,30,0,0.8), rgba(0,10,0,0.9));
            z-index: -1;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid var(--matrix-green);
            margin-bottom: 20px;
            text-shadow: var(--glow);
            animation: glitch 5s infinite;
        }
        
        @keyframes glitch {
            0%, 100% { transform: translateX(0); }
            5% { transform: translateX(-2px); }
            10% { transform: translateX(2px); }
            15% { transform: translateX(0); }
        }
        
        .auth-panel {
            background: var(--terminal-bg);
            border: 1px solid var(--matrix-green);
            padding: 20px;
            margin: 20px auto;
            max-width: 400px;
            box-shadow: var(--glow);
        }
        
        .auth-input {
            width: 100%;
            background: black;
            border: 1px solid var(--matrix-green);
            color: var(--matrix-green);
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
        }
        
        .auth-btn {
            width: 100%;
            background: #002200;
            border: 1px solid var(--matrix-green);
            color: var(--matrix-green);
            padding: 10px;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.3s;
        }
        
        .auth-btn:hover {
            background: var(--matrix-green);
            color: black;
            box-shadow: var(--glow);
        }
        
        .dashboard {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .panel {
            background: var(--terminal-bg);
            border: 1px solid var(--matrix-green);
            padding: 15px;
            box-shadow: var(--glow);
        }
        
        .workers-panel {
            grid-column: 1;
        }
        
        .terminal-panel {
            grid-column: 2;
            grid-row: span 2;
        }
        
        .command-panel {
            grid-column: 1;
        }
        
        .worker-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .worker-item {
            padding: 10px;
            border: 1px solid #004400;
            margin: 5px 0;
            background: #001100;
            transition: all 0.3s;
        }
        
        .worker-item:hover {
            border-color: var(--matrix-green);
            box-shadow: var(--glow);
        }
        
        .worker-item.online {
            border-left: 3px solid var(--matrix-green);
        }
        
        .worker-item.offline {
            border-left: 3px solid #f00;
            opacity: 0.6;
        }
        
        .terminal {
            background: black;
            height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid var(--matrix-green);
            font-family: 'Courier New', monospace;
        }
        
        .terminal-line {
            margin: 2px 0;
        }
        
        .command-input {
            width: 100%;
            background: black;
            border: 1px solid var(--matrix-green);
            color: var(--matrix-green);
            padding: 10px;
            margin-top: 10px;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn {
            flex: 1;
            background: #002200;
            border: 1px solid var(--matrix-green);
            color: var(--matrix-green);
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: var(--matrix-green);
            color: black;
            box-shadow: var(--glow);
        }
        
        .btn.danger {
            background: #220000;
            border-color: #f00;
        }
        
        .btn.danger:hover {
            background: #f00;
            color: black;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .online-dot {
            background: var(--matrix-green);
            box-shadow: 0 0 5px var(--matrix-green);
        }
        
        .offline-dot {
            background: #f00;
            box-shadow: 0 0 5px #f00;
        }
        
        .scanning {
            animation: scan 2s infinite;
        }
        
        @keyframes scan {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <div class="matrix-bg"></div>
    
    <div class="container">
        <div class="header">
            <h1>//_RENDER_FARM_CONTROL_SYSTEM</h1>
            <p>_[SYSTEM_ACTIVE]_//_AWAITING_AUTHENTICATION</p>
        </div>
        
        <div class="auth-panel" id="authPanel">
            <h3>üîê SYSTEM ACCESS</h3>
            <input type="password" id="passwordInput" class="auth-input" placeholder="ENTER_ACCESS_CODE">
            <button class="auth-btn" onclick="authenticate()">INITIATE_CONNECTION</button>
            <div id="authStatus" style="margin-top: 10px; font-size: 12px;"></div>
        </div>
        
        <div class="dashboard" id="dashboard">
            <div class="panel workers-panel">
                <h3>üåê CONNECTED_NODES</h3>
                <div class="btn-group">
                    <button class="btn" onclick="scanWorkers()">SCAN_NETWORK</button>
                    <button class="btn" onclick="refreshStatus()">REFRESH_STATUS</button>
                </div>
                <div class="worker-list" id="workerList">
                    <div class="worker-item scanning">
                        <span class="status-indicator online-dot"></span>
                        SCANNING_FOR_WORKERS...
                    </div>
                </div>
            </div>
            
            <div class="panel terminal-panel">
                <h3>üíª TERMINAL_ACCESS</h3>
                <div class="terminal" id="terminal">
                    <div class="terminal-line">// TERMINAL_READY</div>
                    <div class="terminal-line">// SELECT_WORKER_TO_BEGIN</div>
                </div>
                <select id="workerSelect" class="command-input">
                    <option value="all">BROADCAST_TO_ALL_NODES</option>
                </select>
                <input type="text" id="commandInput" class="command-input" placeholder="EXECUTE_COMMAND..." onkeypress="handleCommandKey(event)">
                <div class="btn-group">
                    <button class="btn" onclick="executeCommand()">EXECUTE</button>
                    <button class="btn" onclick="clearTerminal()">CLEAR</button>
                    <button class="btn danger" onclick="emergencyStop()">EMERGENCY_STOP</button>
                </div>
            </div>
            
            <div class="panel command-panel">
                <h3>‚ö° QUICK_COMMANDS</h3>
                <div class="btn-group">
                    <button class="btn" onclick="quickCommand('tasklist')">PROCESS_LIST</button>
                    <button class="btn" onclick="quickCommand('systeminfo')">SYSTEM_INFO</button>
                    <button class="btn" onclick="quickCommand('ipconfig')">NETWORK_INFO</button>
                </div>
                <div class="btn-group">
                    <button class="btn danger" onclick="quickCommand('taskkill /f /im blender.exe')">KILL_BLENDER</button>
                    <button class="btn danger" onclick="quickCommand('taskkill /f /im maya.exe')">KILL_MAYA</button>
                    <button class="btn danger" onclick="quickCommand('taskkill /f /im 3dsmax.exe')">KILL_3DSMAX</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let authToken = null;
        let selectedWorker = 'all';
        let terminalHistory = [];
        
        function authenticate() {
            const password = document.getElementById('passwordInput').value;
            const statusDiv = document.getElementById('authStatus');
            
            if (!password) {
                statusDiv.innerHTML = '‚ùå ACCESS_DENIED: NO_INPUT';
                return;
            }
            
            // In real implementation, this would be hashed and sent to server
            // For demo, we'll use the hardcoded hash check
            hashPassword(password).then(hash => {
                authToken = password; // In real app, server would return token
                document.getElementById('authPanel').style.display = 'none';
                document.getElementById('dashboard').style.display = 'grid';
                statusDiv.innerHTML = '';
                startWorkerUpdates();
            }).catch(err => {
                statusDiv.innerHTML = '‚ùå ACCESS_VIOLATION: INVALID_CREDENTIALS';
            });
        }
        
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
        }
        
        function startWorkerUpdates() {
            setInterval(updateWorkers, 2000);
            updateWorkers();
        }
        
        async function updateWorkers() {
            if (!authToken) return;
            
            try {
                const response = await fetch('/status', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const workers = await response.json();
                displayWorkers(workers);
            } catch (error) {
                logToTerminal(`‚ùå ERROR: ${error.message}`);
            }
        }
        
        function displayWorkers(workers) {
            const workerList = document.getElementById('workerList');
            const workerSelect = document.getElementById('workerSelect');
            
            workerList.innerHTML = '';
            workerSelect.innerHTML = '<option value="all">BROADCAST_TO_ALL_NODES</option>';
            
            if (Object.keys(workers).length === 0) {
                workerList.innerHTML = '<div class="worker-item scanning"><span class="status-indicator online-dot"></span>NO_WORKERS_DETECTED</div>';
                return;
            }
            
            for (const [id, worker] of Object.entries(workers)) {
                const isOnline = (Date.now() / 1000 - worker.last_seen) < 30;
                const workerItem = document.createElement('div');
                workerItem.className = `worker-item ${isOnline ? 'online' : 'offline'}`;
                workerItem.innerHTML = `
                    <span class="status-indicator ${isOnline ? 'online-dot' : 'offline-dot'}"></span>
                    <strong>${worker.name}</strong> [${worker.ip}]
                    <br><small>CPU: ${worker.cpu_usage}% | STATUS: ${worker.status}</small>
                    ${worker.last_output ? `<br><small>LAST: ${worker.last_output.substring(0, 50)}...</small>` : ''}
                `;
                workerItem.onclick = () => selectWorker(id, worker.name);
                workerList.appendChild(workerItem);
                
                const option = document.createElement('option');
                option.value = id;
                option.textContent = worker.name;
                workerSelect.appendChild(option);
            }
        }
        
        function selectWorker(id, name) {
            selectedWorker = id;
            document.getElementById('workerSelect').value = id;
            logToTerminal(`// SELECTED_WORKER: ${name}`);
        }
        
        function handleCommandKey(event) {
            if (event.key === 'Enter') {
                executeCommand();
            }
        }
        
        async function executeCommand() {
            const command = document.getElementById('commandInput').value;
            const workerId = document.getElementById('workerSelect').value;
            
            if (!command) return;
            
            logToTerminal(`$ ${command} [TO: ${workerId === 'all' ? 'ALL_NODES' : workerId}]`);
            
            try {
                const endpoint = workerId === 'all' ? '/broadcast' : '/command';
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        worker_id: workerId === 'all' ? null : workerId,
                        command: command
                    })
                });
                
                const result = await response.json();
                logToTerminal(`// COMMAND_QUEUED: ${result.status}`);
            } catch (error) {
                logToTerminal(`‚ùå ERROR: ${error.message}`);
            }
            
            document.getElementById('commandInput').value = '';
        }
        
        function quickCommand(command) {
            document.getElementById('commandInput').value = command;
            executeCommand();
        }
        
        function emergencyStop() {
            if (confirm('‚ö†Ô∏è CONFIRM_EMERGENCY_STOP?\nTHIS WILL TERMINATE ALL RENDER PROCESSES!')) {
                quickCommand('taskkill /f /im blender.exe & taskkill /f /im maya.exe & taskkill /f /im 3dsmax.exe');
            }
        }
        
        function scanWorkers() {
            logToTerminal('// INITIATING_NETWORK_SCAN...');
            updateWorkers();
        }
        
        function refreshStatus() {
            updateWorkers();
            logToTerminal('// STATUS_REFRESHED');
        }
        
        function logToTerminal(message) {
            const terminal = document.getElementById('terminal');
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.textContent = message;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
            
            terminalHistory.push(message);
            if (terminalHistory.length > 100) {
                terminalHistory.shift();
            }
        }
        
        function clearTerminal() {
            document.getElementById('terminal').innerHTML = '';
            terminalHistory = [];
            logToTerminal('// TERMINAL_CLEARED');
        }
        
        // Matrix background effect
        function createMatrixEffect() {
            const chars = "01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥";
            const bg = document.querySelector('.matrix-bg');
            
            setInterval(() => {
                const element = document.createElement('div');
                element.style.cssText = `
                    position: absolute;
                    top: -20px;
                    left: ${Math.random() * 100}%;
                    color: #0f0;
                    font-size: ${Math.random() * 10 + 10}px;
                    opacity: ${Math.random() * 0.5 + 0.1};
                    animation: fall ${Math.random() * 2 + 1}s linear forwards;
                `;
                element.textContent = chars[Math.floor(Math.random() * chars.length)];
                bg.appendChild(element);
                
                setTimeout(() => element.remove(), 2000);
            }, 50);
        }
        
        // Add falling animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fall {
                to {
                    top: 100vh;
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
        
        createMatrixEffect();
    </script>
</body>
</html>